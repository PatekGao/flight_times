# 航司航向匹配优化系统使用说明书

## 1. 友情提醒

本项目中涉及读取的所有文件名请与本地对应文件名一一对应。

## 2. 准备工作

### 2.1 环境要求
- Python 3.6+
- Gurobi优化求解器
- 必要的Python包：
  - pandas
  - numpy
  - gurobipy
  - openpyxl

### 2.2 输入文件准备
需要准备以下Excel文件：

1. **输入模板文件**（`输入模板.xlsx`变量名保存于`config.py`）
   - 包含航司信息
   - 航向信息
   - 宽体机数据
   - 其他约束条件

2. **现状数据文件**（`2024_现状.xlsx`变量名保存于`config.py`）
   - 当前航班的航司和航向分配情况

3. **航班比例表**
   - 到达航班比例表（`到达航班比例表.xlsx`变量名保存于`config.py`）
   - 出发航班比例表（`出发航班比例表.xlsx`变量名保存于`config.py`）
   - 两份比例表由`analyze_flights.py`代码运行后自动化生成。改代码的输入文件为
   -     input_name = '2024_现状.xlsx'

4. **航班配对数据**（`final_pairing.xlsx`变量名保存于`config.py`）
   - 该份文档由`TableGeneration`项目导出，在导出后为`到达航班`与`出发航班`sheet加入表头`航司|航向`即可作为输入文件。


## 3. 使用步骤

### 3.1 配置参数
在`config.py`文件中设置以下参数：

1. **文件路径配置**
   ```python
   CURRENT_STATUS_FILE = "2024_现状.xlsx"
   ARR_HOURLY_STATS_FILE = "到达航班比例表.xlsx"
   DEP_HOURLY_STATS_FILE = "出发航班比例表.xlsx"
   PAIRING_FILE = "final_pairing.xlsx"
   OUTPUT_FILE = "final_result.xlsx"
   FINAL_FILE = "final_result_processed.xlsx"
   TEMPLATE_FILE = "输入模板.xlsx"
   ```

2. **优化参数配置**
   - MIP Gap设置
   - 波形偏差设置
   - 宽体机偏差设置

### 3.2 运行程序
1. 确保所有输入文件已放置在正确的目录下
2. 运行主程序：
   ```bash
   python airline_heading_match.py
   ```

### 3.3 查看结果
程序运行完成后，将生成两个输出文件：
- `final_result.xlsx`：原始优化结果
- `final_result_processed_new.xlsx`：处理后的最终结果

## 4. 参数说明

### 4.1 MIP Gap参数(位于`config.py`)
- `DOM_ARR_GAP`：国内进港航班的MIP Gap（默认0.01）
- `INT_ARR_GAP`：国际进港航班的MIP Gap（默认0.07）
- `DOM_DEP_GAP`：国内离港航班的MIP Gap（默认0.02）
- `INT_DEP_GAP`：国际离港航班的MIP Gap（默认0.01）

### 4.2 波形偏差参数(位于`config.py`)
- `DOM_ARR_WAVE_BIAS`：国内进港航班波形偏差
- `INT_ARR_WAVE_BIAS`：国际进港航班波形偏差
- `DOM_DEP_WAVE_BIAS`：国内离港航班波形偏差
- `INT_DEP_WAVE_BIAS`：国际离港航班波形偏差

### 4.3 宽体机偏差参数(位于`config.py`)
- `DOM_ARR_WIDE_BIAS`：国内进港航班宽体机偏差
- `INT_ARR_WIDE_BIAS`：国际进港航班宽体机偏差
- `DOM_DEP_WIDE_BIAS`：国内离港航班宽体机偏差
- `INT_DEP_WIDE_BIAS`：国际离港航班宽体机偏差

### 4.4 无中生有参数(位于`exceptions.py`)
- `ARR_DOM_EXCEPTIONS`：国内进港航司-航向对无中生有例外
- `ARR_INT_EXCEPTIONS`：国际进港航司-航向对无中生有例外
- `DEP_DOM_EXCEPTIONS`：国内离港航司-航向对无中生有例外
- `DEP_INT_EXCEPTIONS`：国际离港航司-航向对无中生有例外

## 5. 输出结果说明

### 5.1 final_result.xlsx
包含以下信息：
- 航班号
- 日期
- 时间
- 分配的航司
- 分配的航向
- 航班类型（进港/离港）
- 市场类型（国内/国际）

### 5.2 final_result_processed.xlsx
包含以下信息：
- 所有航班分配结果
- 统计信息

## 6. 注意事项

1. 确保输入文件格式正确，严格按照模板要求填写
2. 优化过程可能需要较长时间，取决于问题规模